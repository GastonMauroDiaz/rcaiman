% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sample_sky_points.R
\name{sample_sky_points}
\alias{sample_sky_points}
\title{Sample sky points}
\usage{
sample_sky_points(r, bin, seg, dist_to_black = 3, method = "per_cell")
}
\arguments{
\item{r}{numeric \link[terra:SpatRaster-class]{terra::SpatRaster} of one layer. Typically the blue
band of a canopy image.}

\item{bin}{logical \link[terra:SpatRaster-class]{terra::SpatRaster} of one layer. Binary image where
\code{TRUE} marks candidate sky pixels. Typically the output of
\code{\link[=binarize_with_thr]{binarize_with_thr()}}.}

\item{seg}{single-layer \link[terra:SpatRaster-class]{terra::SpatRaster}. Segmentation map of r,
typically created with functions such as \code{\link[=equalarea_segmentation]{equalarea_segmentation()}}, \code{\link[=skygrid_segmentation]{skygrid_segmentation()}},
\code{\link[=ring_segmentation]{ring_segmentation()}} or \code{\link[=sector_segmentation]{sector_segmentation()}}, but any raster with
integer segment labels is accepted. Ignored when \code{method = "local_max"}.}

\item{dist_to_black}{numeric vector of length one or \code{NULL}. Minimum distance
(pixels) to the nearest black pixel for a candidate sky pixel to be valid.
If \code{NULL}, no distance constraint is applied. Ignored with \code{method = local_max}.}

\item{method}{character vector of length one. Sampling method; either
\code{"per_cell"} (default) or \code{"local_max"}.}
}
\value{
\code{data.frame} with columns \code{row} and \code{col}.
}
\description{
Sample representative sky pixels for use in model fitting or interpolation.
}
\details{
Two sampling strategies are provided:
\describe{
\item{\code{"per_cell"}}{select one sky point per cell of a segmentation (\code{seg})
as the brightest pixel marked \code{TRUE} in \code{bin}, provided the cellâ€™s white
pixel count exceeds one fourth of the mean across valid cells.}
\item{\code{"local_max"}}{detect local maxima within a fixed \eqn{9 \times 9}
window, restricted to pixels marked \code{TRUE} in \code{bin}, after removing
patches of connected \code{TRUE} pixels that are implausible based on fixed
area/size thresholds. Each detected maximum is taken as a sky point.
}
}
Use \code{"per_cell"} to promote an even, representative spatial distribution (good
for model fitting), and \code{"local_max"} to be exhaustive for interpolation.
}
\examples{
\dontrun{
caim <- read_caim()
z <- zenith_image(ncol(caim), lens())
a <- azimuth_image(z)
m <- !is.na(z)
r <- caim$Blue

bin <- binarize_by_region(r, ring_segmentation(z, 15), "thr_isodata") &
  select_sky_region(z, 0, 88)

seg <- skygrid_segmentation(z, a, 10)
sky_points <- sample_sky_points(r, bin, seg,
                                 dist_to_black = 3)
plot(bin)
points(sky_points$col, nrow(caim) - sky_points$row, col = 2, pch = 10)
}
}
