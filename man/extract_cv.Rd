% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/extract_cv.R
\name{extract_cv}
\alias{extract_cv}
\title{Extract local CV from sky points}
\usage{
extract_cv(r, sky_points)
}
\arguments{
\item{r}{\link[terra:SpatRaster-class]{terra::SpatRaster}. Image from which \code{sky_points} were
sampled (or any raster with identical dimensions).}

\item{sky_points}{\code{data.frame} with columns \code{row} and \code{col} (raster
coordinates).}
}
\value{
Numeric vector of length equal to \code{nrow(sky_points)}, containing one
robust CV value per sky point.
}
\description{
Compute a robust coefficient of variation (CV) at each sky point using a
\eqn{3 \times 3} neighbourhood in a raster image.
}
\details{
For each sky point, the function extracts the radiance values in a
\eqn{3 \times 3} window centered on the corresponding pixel of \code{r}, and
computes a robust CV defined as:

\deqn{\mathrm{CV}_\mathrm{robust} = \mathrm{MAD} / \mathrm{median}}

where MAD is the median absolute deviation.
This measure is suited for detecting local fluctuations caused by bright
canopy elements or mixed pixels, while being less sensitive to outliers than
a meanâ€“sd based CV.

The extraction procedure mirrors the spatial logic used in
\code{\link[=extract_dn]{extract_dn()}}, but instead of averaging the neighbourhood, it applies a
robust dispersion measure (MAD/median) to quantify local radiance
variability around each point.
}
\examples{
\dontrun{
caim <- read_caim()
r <- caim$Blue
z <- zenith_image(ncol(caim), lens())
a <- azimuth_image(z)

# See fit_cie_model() for details on below file
path <- system.file("external/sky_points.csv",
                    package = "rcaiman")
sky_points <- read.csv(path)
sky_points <- sky_points[c("Y", "X")]
colnames(sky_points) <- c("row", "col")
head(sky_points)
plot(caim$Blue)
points(sky_points$col, nrow(caim) - sky_points$row, col = 2, pch = 10)

extract_cv(caim$Blue, sky_points)

}
}
\seealso{
\code{\link[=extract_dn]{extract_dn()}} for extracting digital numbers and \code{\link[=tune_sky_sampling]{tune_sky_sampling()}} for
an application of this metric.
}
